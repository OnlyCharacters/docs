<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.264f9e21.js" as="script"><link rel="preload" href="/assets/js/2.58244656.js" as="script"><link rel="preload" href="/assets/js/1.dc7adba2.js" as="script"><link rel="preload" href="/assets/js/25.dd49bd8c.js" as="script"><link rel="prefetch" href="/assets/js/10.a9ace829.js"><link rel="prefetch" href="/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/assets/js/12.92b47e85.js"><link rel="prefetch" href="/assets/js/13.ebfb1f42.js"><link rel="prefetch" href="/assets/js/14.3e65117c.js"><link rel="prefetch" href="/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/assets/js/16.9ca9aae8.js"><link rel="prefetch" href="/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/assets/js/20.0d880388.js"><link rel="prefetch" href="/assets/js/21.0ad1d6a3.js"><link rel="prefetch" href="/assets/js/22.7833764e.js"><link rel="prefetch" href="/assets/js/23.d26f133f.js"><link rel="prefetch" href="/assets/js/24.175be845.js"><link rel="prefetch" href="/assets/js/26.0e13a7d9.js"><link rel="prefetch" href="/assets/js/27.93750685.js"><link rel="prefetch" href="/assets/js/28.30b6c37d.js"><link rel="prefetch" href="/assets/js/29.8049f88e.js"><link rel="prefetch" href="/assets/js/3.bc6bba9e.js"><link rel="prefetch" href="/assets/js/30.3c6773b8.js"><link rel="prefetch" href="/assets/js/31.8c67fb32.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/5.7098d77a.js"><link rel="prefetch" href="/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/assets/js/7.6a854e57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://github.com/OnlyCharacters/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://github.com/OnlyCharacters/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/document/" class="sidebar-heading clickable router-link-active open"><span>文档目录</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/syncthing/" class="sidebar-link">Syncthing - 一个开源、安全的同步程序</a></li><li><a href="/document/docker/" class="sidebar-link">Docker</a></li><li><a href="/document/k8s/" aria-current="page" class="active sidebar-link">/document/k8s/</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/k8s/#_1-1-kubernetes-特点" class="sidebar-link">1.1 Kubernetes 特点：</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#_1-2-master-组件" class="sidebar-link">1.2 Master 组件：</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#_2-1-安装-docker" class="sidebar-link">2.1 安装 docker</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#kubectl" class="sidebar-link">kubectl</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/document/syncthing/" class="sidebar-heading clickable"><span>Syncthing</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/syncthing/cert.html" class="sidebar-link">acme.sh 获取证书</a></li><li><a href="/document/syncthing/syncthing-docker.html" class="sidebar-link">Syncthing docker</a></li><li><a href="/document/syncthing/stdiscosrv-docker.html" class="sidebar-link">Stdiscosrv docker</a></li><li><a href="/document/syncthing/strelaysrv-docker.html" class="sidebar-link">Strelaysrv docker</a></li></ul></section></li><li><a href="/document/docker/" class="sidebar-link">Docker</a></li><li><a href="/document/k8s/" aria-current="page" class="active sidebar-link">k8s</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/k8s/#_1-1-kubernetes-特点" class="sidebar-link">1.1 Kubernetes 特点：</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#_1-2-master-组件" class="sidebar-link">1.2 Master 组件：</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#_2-1-安装-docker" class="sidebar-link">2.1 安装 docker</a></li><li class="sidebar-sub-header"><a href="/document/k8s/#kubectl" class="sidebar-link">kubectl</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><h1 id="_1-kubernetes-概述"><a href="#_1-kubernetes-概述" class="header-anchor">#</a> 1 Kubernetes 概述</h1></blockquote> <p>Kubernetes 是容器集群管理系统，是一个开源的平台，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。</p> <h2 id="_1-1-kubernetes-特点"><a href="#_1-1-kubernetes-特点" class="header-anchor">#</a> 1.1 Kubernetes 特点：</h2> <ul><li><p>可移植: 支持公有云，私有云，混合云，多重云（multi-cloud）</p></li> <li><p>可扩展: 模块化, 插件化, 可挂载, 可组合</p></li> <li><p>自动化: 自动部署，自动重启，自动复制，自动伸缩/扩展</p></li></ul> <h2 id="_1-2-master-组件"><a href="#_1-2-master-组件" class="header-anchor">#</a> 1.2 Master 组件：</h2> <blockquote><h1 id="_2-部署-k8s"><a href="#_2-部署-k8s" class="header-anchor">#</a> 2 部署 k8s</h1></blockquote> <h2 id="_2-1-安装-docker"><a href="#_2-1-安装-docker" class="header-anchor">#</a> 2.1 安装 docker</h2> <p>参考：<a href="https://docs.docker.com/engine/install/binaries/" target="_blank" rel="noopener noreferrer">Install Docker Engine from binaries | Docker Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>安装依赖</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># yum</span>
yum <span class="token function">install</span> openssl-devel <span class="token function">git</span> iptables xz-utils

<span class="token comment"># apt</span>
<span class="token function">apt</span> <span class="token function">install</span> libssl-dev <span class="token function">git</span> iptables xz-utils
</code></pre></div></li> <li><p>下载二进制文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 下载地址 https://download.docker.com/linux/static/stable/x86_64/</span>
<span class="token comment"># 本机下载，上传至服务器即可</span>
<span class="token assign-left variable">DOCKER_VERSION</span><span class="token operator">=</span><span class="token string">&quot;24.0.7&quot;</span>
<span class="token assign-left variable">DOCKER_DIR</span><span class="token operator">=</span><span class="token string">&quot;/opt/docker_<span class="token variable">${DOCKER_VERSION}</span>&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${DOCKER_DIR}</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${DOCKER_DIR}</span>/bin
<span class="token builtin class-name">cd</span> <span class="token variable">${DOCKER_DIR}</span>
<span class="token function">wget</span> https://download.docker.com/linux/static/stable/x86_64/docker-<span class="token variable">${DOCKER_VERSION}</span>.tgz
<span class="token function">tar</span> xzvf docker-<span class="token variable">${DOCKER_VERSION}</span>.tgz <span class="token parameter variable">-C</span> <span class="token variable">${DOCKER_DIR}</span>
<span class="token function">mv</span> <span class="token variable">${DOCKER_DIR}</span>/docker <span class="token variable">${DOCKER_DIR}</span>/bin
</code></pre></div></li> <li><p>创建文件夹，添加 containerd 配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/containerd_config
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/containerd_root
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/containerd_sock
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/containerd_state
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/dockerd_exec
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/dockerd_pid
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/dockerd_root
<span class="token function">mkdir</span> <span class="token variable">${DOCKER_DIR}</span>/dockerd_sock
</code></pre></div><p>执行下面命令，将配置文件 config.yml 到 ${DOCKER_DIR}/containerd_config/config.yml</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token variable">${DOCKER_DIR}</span>/containerd_config/config.yml</span>
#   Copyright 2018-2022 Docker Inc.

#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at

#       http://www.apache.org/licenses/LICENSE-2.0

#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

disabled_plugins = [&quot;cri&quot;]

root = &quot;<span class="token variable">${DOCKER_DIR}</span>/containerd_root&quot;
state = &quot;<span class="token variable">${DOCKER_DIR}</span>/containerd_state&quot;
#subreaper = true
#oom_score = 0

[grpc]
address = &quot;<span class="token variable">${DOCKER_DIR}</span>/containerd_sock/containerd.sock&quot;
uid = 0
gid = 0

#[debug]
#  address = &quot;/run/containerd/debug.sock&quot;
#  uid = 0
#  gid = 0
#  level = &quot;info&quot;
EOF</span>
</code></pre></div><p>执行下面命令，配置 daemon.json 到 ${DOCKER_DIR}/dockerd_config/daemon.json</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token variable">${DOCKER_DIR}</span>/dockerd_config/daemon.json</span>
{}
EOF</span>
</code></pre></div></li> <li><p>设置 systemd 服务</p> <p>参考：</p> <ol><li><p><a href="https://github.com/moby/moby/tree/master/contrib/init/systemd" target="_blank" rel="noopener noreferrer">docker.socket &amp; docker.service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/containerd/containerd/blob/main/containerd.service" target="_blank" rel="noopener noreferrer">containerd.service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol> <p>执行下面命令，设置环境变量到 /etc/profile.d/docker.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/profile.d/docker.sh</span>
export PATH=<span class="token variable">${<span class="token environment constant">PATH</span>}</span>:<span class="token variable">${DOCKER_DIR}</span>/bin
export DOCKER_HOST=unix://<span class="token variable">${DOCKER_DIR}</span>/dockerd_sock/docker.sock
EOF</span>
</code></pre></div><ul><li><p>containerd.service</p> <p>执行下面命令，配置 containerd.service 到 /etc/systemd/system/containerd.service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/systemd/system/containerd.service</span>
# Copyright The containerd Authors.
#
# Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target local-fs.target

[Service]
#uncomment to fallback to legacy CRI plugin implementation with podsandbox support.
#Environment=&quot;DISABLE_CRI_SANDBOXES=1&quot;
ExecStartPre=-/sbin/modprobe overlay
ExecStart=<span class="token variable">${DOCKER_DIR}</span>/bin/containerd --config <span class="token variable">${DOCKER_DIR}</span>/containerd_config/config.yml

Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5

# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity

# Comment TasksMax if your systemd version does not supports it.
# Only systemd 226 and above support this version.
TasksMax=infinity
OOMScoreAdjust=-999

[Install]
WantedBy=multi-user.target
EOF</span>
</code></pre></div></li> <li><p>docker.socket</p> <p>执行下面命令，配置 docker.socket 到 /etc/systemd/system/docker.socket</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/systemd/system/docker.socket</span>
[Unit]
Description=Docker Socket for the API

[Socket]
# If /var/run is not implemented as a symlink to /run, you may need to
# specify ListenStream=/var/run/docker.sock instead.
ListenStream=<span class="token variable">${DOCKER_DIR}</span>/dockerd_sock/docker.sock
SocketMode=0660
SocketUser=root
SocketGroup=root

[Install]
WantedBy=sockets.target
EOF</span>
</code></pre></div></li> <li><p>docker.service</p> <p>执行下面命令，配置 docker.service 到 /etc/systemd/system/docker.service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/systemd/system/docker.service</span>
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target docker.socket firewalld.service containerd.service time-set.service
Wants=network-online.target containerd.service
Requires=docker.socket

[Service]
Type=notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/bin/bash -c &quot;PATH=<span class="token variable">${<span class="token environment constant">PATH</span>}</span>:/opt/docker_24.0.7/bin exec <span class="token variable">${DOCKER_DIR}</span>/bin/dockerd --config-file <span class="token variable">${DOCKER_DIR}</span>/dockerd_config/daemon.json --host unix://{DOCKER_DIR}/dockerd_sock/docker.sock --group root --containerd <span class="token variable">${DOCKER_DIR}</span>/containerd_sockcontainerd.sock --data-root <span class="token variable">${DOCKER_DIR}</span>/dockerd_root --exec-root <span class="token variable">${DOCKER_DIR}</span>/dockerd_exec--pidfile <span class="token variable">${DOCKER_DIR}</span>/dockerd_pid/docker.pid
ExecReload=/bin/kill -s HUP <span class="token variable">$MAINPID</span>
TimeoutStartSec=0
RestartSec=2
Restart=always

# Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.
# Both the old, and new location are accepted by systemd 229 and up, so using the old location
# to make them work for either version of systemd.
StartLimitBurst=3

# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.
# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make
# this option work for either version of systemd.
StartLimitInterval=60s

# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity

# Comment TasksMax if your systemd version does not support it.
# Only systemd 226 and above support this option.
TasksMax=infinity

# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes

# kill only the docker process, not all processes in the cgroup
KillMode=process
OOMScoreAdjust=-500

[Install]
WantedBy=multi-user.target
EOF</span>
</code></pre></div></li></ul> <p>使服务生效并开机启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> containerd.service docker.socket docker.service
</code></pre></div></li></ol> <h2 id="kubectl"><a href="#kubectl" class="header-anchor">#</a> kubectl</h2> <p>参考：<a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl" target="_blank" rel="noopener noreferrer">安装 kubeadm、kubelet 和 kubectl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">WORK_DIR</span><span class="token operator">=</span><span class="token string">&quot;/opt/k8s&quot;</span>
<span class="token assign-left variable">ARCH</span><span class="token operator">=</span><span class="token string">&quot;amd64&quot;</span>
<span class="token assign-left variable">K8S_ENV_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${WORK_DIR}</span>/env&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;<span class="token variable">${K8S_ENV_DIR}</span>&quot;</span>
<span class="token builtin class-name">cd</span> <span class="token variable">${WORK_DIR}</span>

<span class="token comment"># 安装 CNI 插件</span>
<span class="token assign-left variable">CNI_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${WORK_DIR}</span>/cni/bin&quot;</span>
<span class="token assign-left variable">CNI_PLUGINS_VERSION</span><span class="token operator">=</span><span class="token string">&quot;v1.3.0&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;<span class="token variable">${CNI_DIR}</span>&quot;</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">&quot;https://github.com/containernetworking/plugins/releases/download/<span class="token variable">${CNI_PLUGINS_VERSION}</span>/cni-plugins-linux-<span class="token variable">${ARCH}</span>-<span class="token variable">${CNI_PLUGINS_VERSION}</span>.tgz&quot;</span> <span class="token operator">|</span> <span class="token function">tar</span> <span class="token parameter variable">-C</span> <span class="token string">&quot;<span class="token variable">$CNI_DIR</span>&quot;</span> <span class="token parameter variable">-xz</span>

<span class="token comment"># 安装 crictl（kubeadm/kubelet 容器运行时接口（CRI）所需）</span>
<span class="token assign-left variable">CRI_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${WORK_DIR}</span>/cri/bin&quot;</span>
<span class="token assign-left variable">CRICTL_VERSION</span><span class="token operator">=</span><span class="token string">&quot;v1.28.0&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;<span class="token variable">${CRI_DIR}</span>&quot;</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">&quot;https://github.com/kubernetes-sigs/cri-tools/releases/download/<span class="token variable">${CRICTL_VERSION}</span>/crictl-<span class="token variable">${CRICTL_VERSION}</span>-linux-<span class="token variable">${ARCH}</span>.tar.gz&quot;</span> <span class="token operator">|</span> <span class="token function">tar</span> <span class="token parameter variable">-C</span> <span class="token string">&quot;<span class="token variable">${CRI_DIR}</span>&quot;</span> <span class="token parameter variable">-xz</span>

<span class="token comment"># 安装 kubeadm, kubelet, kubectl</span>
<span class="token assign-left variable">RELEASE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://dl.k8s.io/release/stable.txt<span class="token variable">)</span></span>&quot;</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> --remote-name-all https://dl.k8s.io/release/<span class="token variable">${RELEASE}</span>/bin/linux/<span class="token variable">${ARCH}</span>/<span class="token punctuation">{</span>kubeadm,kubelet,kubectl<span class="token punctuation">}</span>
<span class="token function">chmod</span> +x <span class="token punctuation">{</span>kubeadm,kubelet,kubectl<span class="token punctuation">}</span>

<span class="token comment"># 下载 service</span>
<span class="token assign-left variable">RELEASE_VERSION</span><span class="token operator">=</span><span class="token string">&quot;v0.16.2&quot;</span>
<span class="token function">curl</span> <span class="token parameter variable">-sSL</span> --remote-name-all <span class="token string">&quot;https://raw.githubusercontent.com/kubernetes/release/<span class="token variable">${RELEASE_VERSION}</span>/cmd/krel/templates/latest/kubelet/kubelet.service&quot;</span>
<span class="token function">curl</span> <span class="token parameter variable">-sSL</span> --remote-name-all <span class="token string">&quot;https://raw.githubusercontent.com/kubernetes/release/<span class="token variable">${RELEASE_VERSION}</span>/cmd/krel/templates/latest/kubeadm/10-kubeadm.conf&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/kubelet.service.d

<span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;s:/usr/bin/kubelet:<span class="token variable">${WORK_DIR}</span>/kubelet:g&quot;</span> kubelet.service <span class="token operator">|</span> <span class="token function">tee</span> /etc/systemd/system/kubelet.service
<span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;s:/usr/bin/kubelet:<span class="token variable">${WORK_DIR}</span>/kubelet:g&quot;</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;s:/etc/sysconfig:<span class="token variable">${WORK_DIR}</span>/env:g&quot;</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;s:/var/lib/kubelet:<span class="token variable">${WORK_DIR}</span>/env:g&quot;</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;s:/etc/kubernetes:<span class="token variable">${WORK_DIR}</span>/env:g&quot;</span> <span class="token number">10</span>-kubeadm.conf <span class="token operator">|</span> <span class="token function">tee</span> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/OnlyCharacters/docs/edit/main/docs/document/k8s/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后编辑于:</span> <span class="time">11/5/2023, 2:41:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/document/docker/" class="prev">
        Docker
      </a></span> <span class="next"><a href="/document/syncthing/cert.html">
        acme.sh 获取证书
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.264f9e21.js" defer></script><script src="/assets/js/2.58244656.js" defer></script><script src="/assets/js/1.dc7adba2.js" defer></script><script src="/assets/js/25.dd49bd8c.js" defer></script>
  </body>
</html>
