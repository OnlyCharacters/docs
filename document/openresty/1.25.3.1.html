<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.25.3.1 | 文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.0b55dd25.js" as="script"><link rel="preload" href="/assets/js/2.58244656.js" as="script"><link rel="preload" href="/assets/js/1.dc7adba2.js" as="script"><link rel="preload" href="/assets/js/27.d97824bd.js" as="script"><link rel="prefetch" href="/assets/js/10.a9ace829.js"><link rel="prefetch" href="/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/assets/js/12.92b47e85.js"><link rel="prefetch" href="/assets/js/13.ebfb1f42.js"><link rel="prefetch" href="/assets/js/14.3e65117c.js"><link rel="prefetch" href="/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/assets/js/16.9ca9aae8.js"><link rel="prefetch" href="/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/assets/js/20.0d880388.js"><link rel="prefetch" href="/assets/js/21.0ad1d6a3.js"><link rel="prefetch" href="/assets/js/22.7833764e.js"><link rel="prefetch" href="/assets/js/23.d26f133f.js"><link rel="prefetch" href="/assets/js/24.175be845.js"><link rel="prefetch" href="/assets/js/25.dd49bd8c.js"><link rel="prefetch" href="/assets/js/26.ab3fc4c5.js"><link rel="prefetch" href="/assets/js/28.6d33ca53.js"><link rel="prefetch" href="/assets/js/29.71a69dbd.js"><link rel="prefetch" href="/assets/js/3.bc6bba9e.js"><link rel="prefetch" href="/assets/js/30.f1e80958.js"><link rel="prefetch" href="/assets/js/31.22cc2918.js"><link rel="prefetch" href="/assets/js/32.08e1923a.js"><link rel="prefetch" href="/assets/js/33.9e35f1d7.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/5.7098d77a.js"><link rel="prefetch" href="/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/assets/js/7.6a854e57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://github.com/OnlyCharacters/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">
  文档
</a></div> <a href="https://github.com/OnlyCharacters/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/document/syncthing/" class="sidebar-heading clickable"><span>Syncthing</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/syncthing/cert.html" class="sidebar-link">acme.sh 获取证书</a></li><li><a href="/document/syncthing/syncthing-docker.html" class="sidebar-link">Syncthing docker</a></li><li><a href="/document/syncthing/stdiscosrv-docker.html" class="sidebar-link">Stdiscosrv docker</a></li><li><a href="/document/syncthing/strelaysrv-docker.html" class="sidebar-link">Strelaysrv docker</a></li></ul></section></li><li><a href="/document/docker/" class="sidebar-link">Docker</a></li><li><a href="/document/k8s/" class="sidebar-link">k8s</a></li><li><section class="sidebar-group depth-0"><a href="/document/openresty/" class="sidebar-heading clickable router-link-active open"><span>Openresty</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/openresty/1.21.4.3.html" class="sidebar-link">1.21.4.3</a></li><li><a href="/document/openresty/1.25.3.1.html" aria-current="page" class="active sidebar-link">1.25.3.1</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_1-25-3-1"><a href="#_1-25-3-1" class="header-anchor">#</a> 1.25.3.1</h1> <p>openresty 在 2024年1月9日的时候更新了 1.25.3.1 版本，其中值得关注的部分包括但不限于：</p> <ul><li><p>使用 nginx 1.25.3（此前使用 1.21，有 0 day 漏洞）</p></li> <li><p>支持 HTTP/3 PCRE2 (更快)</p></li> <li><p>lua-nginx-module 支持使用 lua 处理 ssl</p></li> <li><p>lua-resty-core (性能更新) lua-resty-dns (新清理方法) LuaJIT (合并上游 PR)</p></li></ul> <p>因为 1.25.3.1 版本支持了 PCRE 2，所以编译步骤与此前有略微不同</p> <h3 id="_0-安装编译环境"><a href="#_0-安装编译环境" class="header-anchor">#</a> 0 安装编译环境</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">apt</span> <span class="token function">install</span> gcc <span class="token function">make</span> perl patch <span class="token parameter variable">-y</span>
</code></pre></div><table><thead><tr><th>包名/模块</th> <th>作用</th></tr></thead> <tbody><tr><td><a href="https://openresty.org/cn/download.html" target="_blank" rel="noopener noreferrer">openresty<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>openresty 本体</td></tr> <tr><td><a href="https://github.com/Refinitiv/nginx-sticky-module-ng" target="_blank" rel="noopener noreferrer">nginx-sticky-module-ng<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>根据 cookie 转发到同一 upstream</td></tr> <tr><td><a href="https://github.com/vozlt/nginx-module-vts" target="_blank" rel="noopener noreferrer">nginx-module-vts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>查看 nginx 状态</td></tr> <tr><td><a href="https://github.com/yaoweibin/nginx_upstream_check_module" target="_blank" rel="noopener noreferrer">nginx_upstream_check_module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>检查 upstream</td></tr> <tr><td><a href="https://sourceforge.net/projects/pcre/files/pcre/" target="_blank" rel="noopener noreferrer">pcre<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>正则匹配</td></tr> <tr><td><a href="https://www.openssl.org/source/" target="_blank" rel="noopener noreferrer">openssl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>加解密套件</td></tr> <tr><td><a href="https://zlib.net/" target="_blank" rel="noopener noreferrer">zlib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>传输内容 gzip 压缩</td></tr></tbody></table> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 下载源码、模块</span>
<span class="token function">wget</span> https://openresty.org/download/openresty-1.25.3.1.tar.gz
<span class="token function">wget</span> https://github.com/liberatti/nginx-sticky-module-ng/archive/refs/heads/master.zip <span class="token parameter variable">-O</span> nginx-sticky-module-ng-master.zip
<span class="token function">wget</span> https://github.com/vozlt/nginx-module-vts/archive/refs/heads/master.zip <span class="token parameter variable">-O</span> nginx-module-vts-master.zip
<span class="token function">wget</span> https://github.com/yaoweibin/nginx_upstream_check_module/archive/refs/heads/master.zip <span class="token parameter variable">-O</span> nginx_upstream_check_module-master.zip
<span class="token function">wget</span> https://github.com/PCRE2Project/pcre2/releases/download/pcre2-10.42/pcre2-10.42.tar.gz
<span class="token function">wget</span> https://github.com/openssl/openssl/releases/download/OpenSSL_1_1_1w/openssl-1.1.1w.tar.gz
<span class="token function">wget</span> https://zlib.net/zlib-1.3.1.tar.gz

<span class="token comment"># 解压</span>
<span class="token function">find</span> ./ <span class="token parameter variable">-name</span> <span class="token string">&quot;*.tar.gz&quot;</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-I</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">tar</span> xzvf <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">find</span> ./ <span class="token parameter variable">-name</span> <span class="token string">&quot;*.zip&quot;</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-I</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">unzip</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-编译"><a href="#_1-编译" class="header-anchor">#</a> 1 编译</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 添加环境变量</span>
<span class="token assign-left variable">OPENRESTY_VERSION</span><span class="token operator">=</span><span class="token number">1.25</span>.3.1
<span class="token assign-left variable">NGINX_VERSION</span><span class="token operator">=</span><span class="token number">1.25</span>.3

<span class="token comment"># 编译 LuaJIT，并删除动态库，让链接的时候使用静态库链接</span>
<span class="token builtin class-name">cd</span> openresty-<span class="token variable">${OPENRESTY_VERSION}</span>
<span class="token builtin class-name">cd</span> bundle/LuaJIT-*
<span class="token function">make</span> <span class="token function">install</span> -j<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> ^processor /proc/cpuinfo<span class="token variable">)</span></span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token assign-left variable">LUAROOT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> lib/*.so*
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>

<span class="token comment"># nginx-module-vts 和 nginx_upstream_check_module 有冲突，需要打补丁</span>
<span class="token builtin class-name">cd</span> bundle/nginx-<span class="token variable">${NGINX_VERSION}</span>
patch <span class="token parameter variable">-p1</span> <span class="token operator">&lt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/nginx_upstream_check_module-master/check_1.20.1+.patch
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/

<span class="token comment"># 搜索并去掉 without-pcre2 </span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;/push @ngx_opts, '--without-pcre2';/d&quot;</span> configure

<span class="token comment"># 设置编译选项</span>
./configure <span class="token punctuation">\</span>
    -j<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> ^processor /proc/cpuinfo<span class="token variable">)</span></span><span class="token punctuation">\</span>
    <span class="token parameter variable">--prefix</span><span class="token operator">=</span>.<span class="token punctuation">\</span>
    --with-cc-opt<span class="token operator">=</span><span class="token string">&quot;-O2&quot;</span><span class="token punctuation">\</span>
    --with-luajit<span class="token operator">=</span><span class="token variable">${LUAROOT}</span><span class="token punctuation">\</span>
    --with-http_v2_module<span class="token punctuation">\</span>
    --with-http_v3_module<span class="token punctuation">\</span>
    --with-pcre-jit<span class="token punctuation">\</span>
    --with-http_stub_status_module<span class="token punctuation">\</span>
    --with-http_ssl_module<span class="token punctuation">\</span>
    --with-http_sub_module<span class="token punctuation">\</span>
    --with-stream<span class="token punctuation">\</span>
    --with-stream_ssl_module<span class="token punctuation">\</span>
    --with-stream_ssl_preread_module<span class="token punctuation">\</span>
    --add-module<span class="token operator">=</span><span class="token punctuation">..</span>/nginx-module-vts-master<span class="token punctuation">\</span>
    --add-module<span class="token operator">=</span><span class="token punctuation">..</span>/nginx_upstream_check_module-master<span class="token punctuation">\</span>
    --add-module<span class="token operator">=</span><span class="token punctuation">..</span>/nginx-sticky-module-ng-master<span class="token punctuation">\</span>
    --with-zlib<span class="token operator">=</span><span class="token punctuation">..</span>/zlib-1.3.1<span class="token punctuation">\</span>
    --with-pcre<span class="token operator">=</span><span class="token punctuation">..</span>/pcre2-10.42<span class="token punctuation">\</span>
    --with-openssl<span class="token operator">=</span><span class="token punctuation">..</span>/openssl-1.1.1w<span class="token punctuation">\</span>
    --with-http_iconv_module

<span class="token comment"># 编译，安装</span>
gmake -j<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> ^processor /proc/cpuinfo<span class="token variable">)</span></span>
gmake <span class="token function">install</span>

<span class="token comment"># 复制安装内容到新目录，并打包，包内的 openresty 可分发</span>
<span class="token function">mkdir</span> openresty_<span class="token variable">${OPENRESTY_VERSION}</span> <span class="token parameter variable">-p</span>
<span class="token function">cp</span> bundle/LuaJIT-* ./openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/luajit <span class="token parameter variable">-r</span>
<span class="token function">cp</span> lualib ./openresty_<span class="token variable">${OPENRESTY_VERSION}</span> <span class="token parameter variable">-r</span>
<span class="token function">cp</span> nginx ./openresty_<span class="token variable">${OPENRESTY_VERSION}</span> <span class="token parameter variable">-r</span>
<span class="token function">cp</span> pod ./openresty_<span class="token variable">${OPENRESTY_VERSION}</span> <span class="token parameter variable">-r</span>
<span class="token function">cp</span> site ./openresty_<span class="token variable">${OPENRESTY_VERSION}</span> <span class="token parameter variable">-r</span>
<span class="token function">tar</span> czf openresty_<span class="token variable">${OPENRESTY_VERSION}</span>.tar.gz openresty_<span class="token variable">${OPENRESTY_VERSION}</span>

<span class="token comment"># 配置 logrotate</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/logrotate.d/openresty_<span class="token variable">${OPENRESTY_VERSION}</span></span>
<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/logs/access.log
<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/logs/error.log
{
    daily
    rotate 15
    copytruncate
    missingok
    dateext
    compress
    notifempty
}
EOF</span>

<span class="token comment"># 配置 systemd</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/systemd/system/nginx.service</span>
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=syslog.target network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target

[Service]
Type=forking
WorkingDirectory=<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>
PIDFile=<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/logs/nginx.pid
ExecStartPre=<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/sbin/nginx -t
ExecStart=<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/sbin/nginx
ExecReload=<span class="token variable">${INSTALL_DIR}</span>/openresty_<span class="token variable">${OPENRESTY_VERSION}</span>/nginx/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT <span class="token variable">$MAINPID</span>
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF</span>
</code></pre></div><blockquote><p>编译使用 PCRE2，但是 configure 脚本里面居然强制添加了 --without-pcre2 参数，因此需要从脚本中删除这一行才能正常编译</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/OnlyCharacters/docs/edit/main/docs/document/openresty/1.25.3.1.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后编辑于:</span> <span class="time">2/18/2024, 3:44:15 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/document/openresty/1.21.4.3.html" class="prev">
        1.21.4.3
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0b55dd25.js" defer></script><script src="/assets/js/2.58244656.js" defer></script><script src="/assets/js/1.dc7adba2.js" defer></script><script src="/assets/js/27.d97824bd.js" defer></script>
  </body>
</html>
