(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{308:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_1-25-3-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-25-3-1"}},[t._v("#")]),t._v(" 1.25.3.1")]),t._v(" "),a("p",[t._v("openresty 在 2024年1月9日的时候更新了 1.25.3.1 版本，其中值得关注的部分包括但不限于：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用 nginx 1.25.3（此前使用 1.21，有 0 day 漏洞）")])]),t._v(" "),a("li",[a("p",[t._v("支持 HTTP/3 PCRE2 (更快)")])]),t._v(" "),a("li",[a("p",[t._v("lua-nginx-module 支持使用 lua 处理 ssl")])]),t._v(" "),a("li",[a("p",[t._v("lua-resty-core (性能更新) lua-resty-dns (新清理方法) LuaJIT (合并上游 PR)")])])]),t._v(" "),a("p",[t._v("因为 1.25.3.1 版本支持了 PCRE 2，所以编译步骤与此前有略微不同")]),t._v(" "),a("h3",{attrs:{id:"_0-安装编译环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-安装编译环境"}},[t._v("#")]),t._v(" 0 安装编译环境")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" perl patch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("包名/模块")]),t._v(" "),a("th",[t._v("作用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("a",{attrs:{href:"https://openresty.org/cn/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("openresty"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("openresty 本体")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://github.com/Refinitiv/nginx-sticky-module-ng",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx-sticky-module-ng"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("根据 cookie 转发到同一 upstream")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://github.com/vozlt/nginx-module-vts",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx-module-vts"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("查看 nginx 状态")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://github.com/yaoweibin/nginx_upstream_check_module",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx_upstream_check_module"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("检查 upstream")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://sourceforge.net/projects/pcre/files/pcre/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pcre"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("正则匹配")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://www.openssl.org/source/",target:"_blank",rel:"noopener noreferrer"}},[t._v("openssl"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("加解密套件")])]),t._v(" "),a("tr",[a("td",[a("a",{attrs:{href:"https://zlib.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("zlib"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("传输内容 gzip 压缩")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载源码、模块")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://openresty.org/download/openresty-1.25.3.1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/liberatti/nginx-sticky-module-ng/archive/refs/heads/master.zip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" nginx-sticky-module-ng-master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/vozlt/nginx-module-vts/archive/refs/heads/master.zip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" nginx-module-vts-master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/yaoweibin/nginx_upstream_check_module/archive/refs/heads/master.zip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" nginx_upstream_check_module-master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/PCRE2Project/pcre2/releases/download/pcre2-10.42/pcre2-10.42.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/openssl/openssl/releases/download/OpenSSL_1_1_1w/openssl-1.1.1w.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://zlib.net/zlib-1.3.1.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" ./ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.tar.gz"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("xargs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xzvf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" ./ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.zip"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("xargs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-编译"}},[t._v("#")]),t._v(" 1 编译")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加环境变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OPENRESTY_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.25")]),t._v(".3.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NGINX_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.25")]),t._v(".3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译 LuaJIT，并删除动态库，让链接的时候使用静态库链接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" openresty-"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" bundle/LuaJIT-*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -j"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" ^processor /proc/cpuinfo"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LUAROOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" lib/*.so*\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-module-vts 和 nginx_upstream_check_module 有冲突，需要打补丁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" bundle/nginx-"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NGINX_VERSION}")]),t._v("\npatch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/nginx_upstream_check_module-master/check_1.20.1+.patch\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 搜索并去掉 without-pcre2 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"/push @ngx_opts, '--without-pcre2';/d\"")]),t._v(" configure\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置编译选项")]),t._v("\n./configure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -j"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" ^processor /proc/cpuinfo"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-cc-opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-O2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-luajit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LUAROOT}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_v2_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_v3_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-pcre-jit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_stub_status_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_ssl_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_sub_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-stream_ssl_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-stream_ssl_preread_module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/nginx-module-vts-master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/nginx_upstream_check_module-master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --add-module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/nginx-sticky-module-ng-master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-zlib"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zlib-1.3.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-pcre"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/pcre2-10.42"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/openssl-1.1.1w"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --with-http_iconv_module\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译，安装")]),t._v("\ngmake -j"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" ^processor /proc/cpuinfo"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\ngmake "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制安装内容到新目录，并打包，包内的 openresty 可分发")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" bundle/LuaJIT-* ./openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/luajit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" lualib ./openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" nginx ./openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" pod ./openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" site ./openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" czf openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v(".tar.gz openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 logrotate")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/logrotate.d/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/logs/access.log\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/logs/error.log\n{\n    daily\n    rotate 15\n    copytruncate\n    missingok\n    dateext\n    compress\n    notifempty\n}\nEOF")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 systemd")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/systemd/system/nginx.service")]),t._v("\n[Unit]\nDescription=The NGINX HTTP and reverse proxy server\nAfter=syslog.target network-online.target remote-fs.target nss-lookup.target\nWants=network-online.target\n\n[Service]\nType=forking\nWorkingDirectory="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("\nPIDFile="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/logs/nginx.pid\nExecStartPre="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/sbin/nginx -t\nExecStart="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/sbin/nginx\nExecReload="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${INSTALL_DIR}")]),t._v("/openresty_"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${OPENRESTY_VERSION}")]),t._v("/nginx/sbin/nginx -s reload\nExecStop=/bin/kill -s QUIT "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MAINPID")]),t._v("\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("编译使用 PCRE2，但是 configure 脚本里面居然强制添加了 --without-pcre2 参数，因此需要从脚本中删除这一行才能正常编译")])])])}),[],!1,null,null,null);a.default=e.exports}}]);